webpackJsonp([1],{"9STC":function(e,t){},"GXL/":function(e,t){},Gm00:function(e,t){},NHnr:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("kV13"),o={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var i=s("C7Lr")({name:"App"},o,!1,function(e){s("9STC")},null,null).exports,n=s("5inH"),l=s("ZLEe"),r=s.n(l),c=s("3cXf"),d=s.n(c),u=s("njIZ"),h=s.n(u),m=s("a1gs"),b=s("2YKG"),v=s("+sCy"),f=s.n(v),g=r()(f.a),p={name:"ConfigModal",props:{visible:Boolean},data:function(){return{activeName:"first",themes:g,theme:window.localStorage.getItem("themeName")||null,bgimg:window.localStorage.getItem("bgimg")||null}},computed:{colors:function(){return this.theme?f.a[this.theme]:null}},watch:{theme:function(e){window.localStorage.setItem("themeName",e),this.$emit("setTheme",f.a[e])}},methods:{handleUpload:function(e){var t=this,s=event.target.files[0],a=new FileReader;a.readAsDataURL(s),a.onload=function(e){t.bgimg=e.target.result,window.localStorage.setItem("bgimg",e.target.result)}},closeConfig:function(){this.$emit("configOnClose",123)}}},C={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],staticClass:"dialog-modal",on:{click:function(t){return t.target!==t.currentTarget?null:e.$emit("update:visible",!1)}}},[s("div",{staticClass:"config-container"},[s("el-button",{staticStyle:{float:"right",border:"0"},attrs:{icon:"el-icon-close"},nativeOn:{click:function(t){return e.closeConfig(t)}}}),e._v(" "),e._m(0),e._v(" "),s("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[s("el-tab-pane",{attrs:{label:"终端主题",name:"first"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择主题"},model:{value:e.theme,callback:function(t){e.theme=t},expression:"theme"}},e._l(e.themes,function(e){return s("el-option",{key:e,attrs:{label:e,value:e}})}),1),e._v(" "),e.theme?s("div",[s("p",{staticClass:"title"},[e._v("基础颜色")]),e._v(" "),s("el-row",{staticClass:"theme-colors",attrs:{type:"flex"}},[s("el-col",{attrs:{span:8}},[s("div",{staticClass:"show-color",style:{backgroundColor:e.colors.background}}),e._v(" "),s("div",[e._v("Background")])]),e._v(" "),s("el-col",{attrs:{span:8}},[s("div",{staticClass:"show-color",style:{backgroundColor:e.colors.foreground}}),e._v(" "),s("div",[e._v("Foreground")])]),e._v(" "),s("el-col",{attrs:{span:8}},[s("div",{staticClass:"show-color",style:{backgroundColor:e.colors.cursor}}),e._v(" "),s("div",[e._v("Cursor")])])],1),e._v(" "),s("p",{staticClass:"title"},[e._v("ANSI Colors")]),e._v(" "),s("el-row",{staticClass:"theme-colors",attrs:{type:"flex"}},[s("el-col",{attrs:{span:3}},[s("div",{staticClass:"show-color",style:{backgroundColor:e.colors.black}}),e._v(" "),s("div",[e._v("Black")])]),e._v(" "),s("el-col",{attrs:{span:3}},[s("div",{staticClass:"show-color",style:{backgroundColor:e.colors.red}}),e._v(" "),s("div",[e._v("Red")])]),e._v(" "),s("el-col",{attrs:{span:3}},[s("div",{staticClass:"show-color",style:{backgroundColor:e.colors.green}}),e._v(" "),s("div",[e._v("Green")])]),e._v(" "),s("el-col",{attrs:{span:3}},[s("div",{staticClass:"show-color",style:{backgroundColor:e.colors.yellow}}),e._v(" "),s("div",[e._v("Yellow")])]),e._v(" "),s("el-col",{attrs:{span:3}},[s("div",{staticClass:"show-color",style:{backgroundColor:e.colors.blue}}),e._v(" "),s("div",[e._v("Blue")])]),e._v(" "),s("el-col",{attrs:{span:3}},[s("div",{staticClass:"show-color",style:{backgroundColor:e.colors.magenta}}),e._v(" "),s("div",[e._v("Magenta")])]),e._v(" "),s("el-col",{attrs:{span:3}},[s("div",{staticClass:"show-color",style:{backgroundColor:e.colors.cyan}}),e._v(" "),s("div",[e._v("Cyan")])]),e._v(" "),s("el-col",{attrs:{span:3}},[s("div",{staticClass:"show-color",style:{backgroundColor:e.colors.white}}),e._v(" "),s("div",[e._v("White")])])],1),e._v(" "),s("el-row",{staticClass:"theme-colors",attrs:{type:"flex"}},[s("el-col",{attrs:{span:3}},[s("div",{staticClass:"show-color",style:{backgroundColor:e.colors.brightBlack}}),e._v(" "),s("div",[e._v("BrightBlack")])]),e._v(" "),s("el-col",{attrs:{span:3}},[s("div",{staticClass:"show-color",style:{backgroundColor:e.colors.brightRed}}),e._v(" "),s("div",[e._v("BrightRed")])]),e._v(" "),s("el-col",{attrs:{span:3}},[s("div",{staticClass:"show-color",style:{backgroundColor:e.colors.brightGreen}}),e._v(" "),s("div",[e._v("BrightGreen")])]),e._v(" "),s("el-col",{attrs:{span:3}},[s("div",{staticClass:"show-color",style:{backgroundColor:e.colors.brightYellow}}),e._v(" "),s("div",[e._v("BrightYellow")])]),e._v(" "),s("el-col",{attrs:{span:3}},[s("div",{staticClass:"show-color",style:{backgroundColor:e.colors.brightBlue}}),e._v(" "),s("div",[e._v("BrightBlue")])]),e._v(" "),s("el-col",{attrs:{span:3}},[s("div",{staticClass:"show-color",style:{backgroundColor:e.colors.brightMagenta}}),e._v(" "),s("div",[e._v("BrightMagenta")])]),e._v(" "),s("el-col",{attrs:{span:3}},[s("div",{staticClass:"show-color",style:{backgroundColor:e.colors.brightCyan}}),e._v(" "),s("div",[e._v("BrightCyan")])]),e._v(" "),s("el-col",{attrs:{span:3}},[s("div",{staticClass:"show-color",style:{backgroundColor:e.colors.brightWhite}}),e._v(" "),s("div",[e._v("BrightWhite")])])],1)],1):e._e()],1)],1)],1)])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("div",{staticStyle:{width:"80px",height:"20px"}})])}]};var T=s("C7Lr")(p,C,!1,function(e){s("Gm00")},"data-v-07a01bde",null).exports,w=s("y7PL"),_=s.n(w),y=window.localStorage,k={name:"THTerm",components:{ConfigModal:T},data:function(){return{drawer:!1,activeName:"xtd1",createdTimes:0,termContainerIds:{},editableTabsValue:"1",editableTabs:[],tabIndex:1,sockets:{},addons:{},terms:{},termBox:{height:500},isFullscreen:!1,fontSize:14,dialogVisible:!1,theme:null,defaultTheme:{background:"#000",Foreground:"#fff"},launchAPI:"http://127.0.0.1/launch/terminal/?vapp=shell"}},computed:{currentView:function(){return this.arr[this.index]}},watch:{activeName:function(e){this.$router.push(this.$route.path+"?tab="+e)}},created:function(){y.setItem("jobWorkDir","jiaza")},mounted:function(){var e=document.getElementById("tab-container-id_999"),t=window.getComputedStyle(e).fontSize;this.fontSize=parseInt(t.substring(0,t.indexOf("px")));var s=this.$route.query.tab,a="xtd-"+h()(),o={title:"Tab 1",name:"1",divid:a,terminalName:"Term-1"};this.editableTabs.push(o),this.termContainerIds[this.tabIndex]=a,null==s&&(s="xtd1"),s&&(this.activeName=s,console.log(this.terms),this.createNewTerm(a,1));var i=this;window.onresize=function(){i.clientHeight=document.documentElement.clientHeight+"px",console.log(i.editableTabsValue),i.addons[i.editableTabsValue].fit();var e={stty:"yes",cols:i.terms[i.editableTabsValue].cols,rows:i.terms[i.editableTabsValue].rows},t=d()(e);console.log(t),i.sockets[i.editableTabsValue].send(t)}},methods:{screenfullfunc:function(){if(!_.a.isEnabled)return this.$message({message:"您的浏览器无法进去全屏模式！",type:"warning"}),!1;_.a.toggle(),this.isFullscreen=!0},resetSettings:function(){var e=document.getElementById("tab-container-id_999"),t=window.getComputedStyle(e).fontSize;this.fontSize=parseInt(t.substring(0,t.indexOf("px")));var s=this.terms[this.editableTabsValue];this.theme=this.defaultTheme,s.setOption("fontSize",this.fontSize),s.setOption("theme",this.theme);var a={stty:"yes",cols:this.terms[this.editableTabsValue].cols,rows:this.terms[this.editableTabsValue].rows},o=d()(a);this.sockets[this.editableTabsValue].send(o),this.addons[this.editableTabsValue].fit()},handleTabsEdit:function(e,t){var s=this;if("add"===t){if(r()(this.terms).length>7)return void this.$message({message:"HPC云最多支持8个终端！",type:"warning"});var a=++this.tabIndex+"",o="Term-"+a,i="xtd-"+h()();this.editableTabs.push({title:"Tab "+a,name:a,divid:i,terminalName:o}),this.termContainerIds[this.tabIndex]=i,this.editableTabsValue=a,this.$nextTick(function(){s.createNewTerm(i,s.tabIndex)})}if("remove"===t)if(1===r()(this.terms).length)this.$confirm("您将要关闭唯一一个HPC云终端窗口","请确认是否关闭",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){console.log(e);var t=s.editableTabs,a=s.editableTabsValue;a===e&&t.forEach(function(s,o){if(s.name===e){var i=t[o+1]||t[o-1];i&&(a=i.name)}}),s.terms[e].dispose(),delete s.terms[e],s.sockets[e].close(),delete s.sockets[e],delete s.addons[e],delete s.termContainerIds[e],s.editableTabsValue=a,s.editableTabs=t.filter(function(t){return t.name!==e})}).catch(function(){console.log("保留最后一个终端窗口")});else{console.log(e);var n=this.editableTabs,l=this.editableTabsValue;l===e&&n.forEach(function(t,s){if(t.name===e){var a=n[s+1]||n[s-1];a&&(l=a.name)}}),delete this.terms[e],this.editableTabsValue=l,this.editableTabs=n.filter(function(t){return t.name!==e})}},handleChangeTheme:function(e){this.theme=e,console.log(this.theme),this.terms[this.editableTabsValue].setOption("theme",this.theme),window.localStorage.setItem("theme",d()(e))},changeFontSize:function(e){this.terms[this.editableTabsValue].setOption("fontSize",e);var t={stty:"yes",cols:this.terms[this.editableTabsValue].cols,rows:this.terms[this.editableTabsValue].rows},s=d()(t);this.sockets[this.editableTabsValue].send(s),this.addons[this.editableTabsValue].fit()},handleClick:function(e,t){var s=this.terms[this.editableTabsValue],a=this;this.$nextTick(function(){console.log(a.termContainerIds[a.editableTabsValue]),document.getElementById(a.termContainerIds[a.editableTabsValue]).innerHTML="";var e=new b.FitAddon;a.addons[a.editableTabsValue]=e,s.loadAddon(e),s.setOption("fontSize",a.fontSize),console.log(s),console.log(a.defaultTheme),console.log(a.theme),null!=a.theme?s.setOption("theme",a.theme):s.setOption("theme"),s.open(document.getElementById(a.termContainerIds[a.editableTabsValue])),a.addons[a.editableTabsValue].fit();var t={stty:"yes",cols:a.terms[a.editableTabsValue].cols,rows:a.terms[a.editableTabsValue].rows},o=d()(t);console.log(o),a.sockets[a.editableTabsValue].send(o),s.focus()})},addTab:function(e){var t=this;if(r()(this.terms).length>7)alert("HPC云最多支持8个终端！");else{var s=++this.tabIndex+"",a="Term-"+s,o="xtd-"+h()();this.editableTabs.push({title:"Tab "+s,name:s,divid:o,terminalName:a}),this.termContainerIds[this.tabIndex]=o,this.editableTabsValue=s,this.$nextTick(function(){setTimeout(function(){t.createNewTerm(o,t.tabIndex)},100)})}},createNewTerm:function(e,t){var s=this;console.log(document.getElementById(e));var a=this.launchAPI,o=this;return this.axios.post(a).then(function(a){if("yes"===a.data.success){var i=a.data.ws_url,n=new WebSocket(i);n.binaryType="arraybuffer";var l=new m.Terminal({cursorBlink:!0,fontSize:s.fontSize});if(null!=s.theme&&l.setOption("theme",s.theme),n.onmessage=function(e){e.data instanceof ArrayBuffer?l.writeUtf8(o.utf8ByteToUnicodeStr(new Uint8Array(e.data))):alert(e.data)},n.onclose=function(){l.write("Session terminated by server!")},n.onopen=function(){console.log("You can send some command to server here!!");var e={stty:"yes",cols:l.cols,rows:l.rows},t=d()(e);n.send(t),null!=y.getItem("jobWorkDir")&&"2"===this.editableTabsValue&&setTimeout(function(){n.send("cd jiaza\r")},200)},s.sockets[t]=n,l.onData(function(e){n.send((new TextEncoder).encode(e))}),l.onTitleChange(function(e){document.title=e}),l.writeln("欢迎使用天河WEB终端!"),o.activeName!==t){var c=new b.FitAddon;o.addons[s.editableTabsValue]=c,l.loadAddon(c),l.open(document.getElementById(e)),c.fit()}l.focus(),s.terms[t]=l}else alert(a.data);console.log(r()(s.terms).length)}).catch(function(e){console.log(e)}),null},configOnClose:function(e){console.log("get data from sub Compenent"+e),this.dialogVisible=!1},utf8ByteToUnicodeStr:function(e){for(var t="",s=0;s<e.length;){var a=e[s],o=0;a>>>7==0?(t+=String.fromCharCode(e[s]),s+=1):252==(252&a)?(o=(3&e[s])<<30,o|=(63&e[s+1])<<24,o|=(63&e[s+2])<<18,o|=(63&e[s+3])<<12,o|=(63&e[s+4])<<6,o|=63&e[s+5],t+=String.fromCharCode(o),s+=6):248==(248&a)?(o=(7&e[s])<<24,o|=(63&e[s+1])<<18,o|=(63&e[s+2])<<12,o|=(63&e[s+3])<<6,o|=63&e[s+4],t+=String.fromCharCode(o),s+=5):240==(240&a)?(o=(15&e[s])<<18,o|=(63&e[s+1])<<12,o|=(63&e[s+2])<<6,o|=63&e[s+3],t+=String.fromCharCode(o),s+=4):224==(224&a)?(o=(31&e[s])<<12,o|=(63&e[s+1])<<6,o|=63&e[s+2],t+=String.fromCharCode(o),s+=3):192==(192&a)?(o=(63&e[s])<<6,o|=63&e[s+1],t+=String.fromCharCode(o),s+=2):(t+=String.fromCharCode(e[s]),s+=1)}return t},showCreatedTimes:function(){this.createdTimes=this.createdTimes+1},removeTab:function(e){console.log(e);var t=this.editableTabs,s=this.editableTabsValue;s===e&&t.forEach(function(a,o){if(a.name===e){var i=t[o+1]||t[o-1];i&&(s=i.name)}}),delete this.terms[e],this.editableTabsValue=s,this.editableTabs=t.filter(function(t){return t.name!==e})},measureChar:function(e){var t=e.innerHTML;e.style.display="inline",e.innerHTML="W";var s=e.getBoundingClientRect().width;e.style.display="";var a=parseInt(e.offsetHeight);return e.innerHTML=t,{width:s,height:a}}}},x={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"termcontainer",staticClass:"tab-container",attrs:{id:"tab-container-id_999"}},[s("el-row",[s("el-col",{attrs:{xs:{span:4,offset:16},sm:{span:2,offset:20},md:{span:1,offset:22},lg:{span:1,offset:22},xl:{span:1,offset:22}}},[s("el-button",{staticClass:"el-icon-setting",staticStyle:{float:"right"},attrs:{type:"text"},on:{click:function(t){e.drawer=!0}}},[e._v("终端设置")])],1),e._v(" "),s("el-col",{attrs:{xs:4,sm:2,md:1,lg:1,xl:{span:1}}},[s("el-button",{staticClass:"el-icon-full-screen",staticStyle:{float:"right"},attrs:{type:"text"},on:{click:e.screenfullfunc}},[e._v("全屏")])],1)],1),e._v(" "),s("el-tabs",{staticStyle:{height:"100%"},attrs:{type:"card",editable:""},on:{edit:e.handleTabsEdit,"tab-click":e.handleClick},model:{value:e.editableTabsValue,callback:function(t){e.editableTabsValue=t},expression:"editableTabsValue"}},e._l(e.editableTabs,function(e){return s("el-tab-pane",{key:e.name,staticStyle:{height:"100%"},attrs:{label:e.terminalName,name:e.name}},[s("div",{staticClass:"xterm xterm_height",attrs:{id:e.divid}})])}),1),e._v(" "),s("el-drawer",{attrs:{visible:e.drawer,direction:"ttb",size:"90px"},on:{"update:visible":function(t){e.drawer=t}}},[s("el-row",{attrs:{gutter:10}},[s("el-col",{staticClass:"hidden-sm-and-down",attrs:{xs:4,sm:4,md:3,lg:3,xl:2}},[s("el-button",[e._v("设置字体大小")])],1),e._v(" "),s("el-col",{staticClass:"hidden-sm-and-down",attrs:{xs:10,sm:10,md:15,lg:15,xl:18}},[s("el-slider",{attrs:{min:8,max:48,"show-input":""},on:{change:e.changeFontSize},model:{value:e.fontSize,callback:function(t){e.fontSize=t},expression:"fontSize"}})],1),e._v(" "),s("el-col",{attrs:{xs:4,sm:4,md:3,lg:3,xl:2}},[s("el-button",{on:{click:e.resetSettings}},[e._v("重置")])],1),e._v(" "),s("el-col",{staticStyle:{float:"right"},attrs:{xs:6,sm:6,md:3,lg:3,xl:2}},[s("el-button",{on:{click:function(t){e.dialogVisible=!0}}},[e._v("选择主题")])],1)],1),e._v(" "),s("config-modal",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t},setTheme:e.handleChangeTheme,configOnClose:e.configOnClose}})],1)],1)},staticRenderFns:[]};var S=s("C7Lr")(k,x,!1,function(e){s("gYW2")},null,null).exports;a.default.use(n.a);var V=new n.a({routes:[{path:"/",name:"THTerm",component:S}]}),I=s("I29D"),B=s.n(I),N=s("Iufj"),z=s.n(N),E=s("c+XW"),H=s.n(E);s("GXL/"),s("gkmS"),s("Q5Xx");B.a.defaults.xsrfHeaderName="X-CSRFToken",B.a.defaults.xsrfCookieName="csrftoken",a.default.config.productionTip=!1,a.default.use(z.a,B.a),a.default.use(H.a),new a.default({el:"#app",router:V,components:{App:i},template:"<App/>"})},Q5Xx:function(e,t){},gYW2:function(e,t){},gkmS:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.28da9bd3804c680dca1a.js.map