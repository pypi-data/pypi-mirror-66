!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("chart.js")):"function"==typeof define&&define.amd?define(["exports","chart.js"],e):e(t.ChartBoxPlot={},t.Chart)}("undefined"!=typeof self?self:this,function(t,u){"use strict";function h(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=[],r=!0,n=!1,o=void 0;try{for(var a,l=t[Symbol.iterator]();!(r=(a=l.next()).done)&&(i.push(a.value),!e||i.length!==e);r=!0);}catch(t){n=!0,o=t}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return i}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function e(t,e){return t-e}function c(o,t){var a=(o=o.slice().sort(e)).length-1;return t.map(function(t){if(0===t)return o[0];if(1===t)return o[a];var e=1+t*a,i=Math.floor(e),r=e-i,n=o[i-1];return 0===r?n:n+r*(o[i]-n)})}function n(t){return 1/Math.sqrt(2*Math.PI)*Math.exp(-.5*t*t)}function l(t){var e,i=((e=c(t,[.25,.75]))[1]-e[0])/1.34;return 1.06*Math.min(Math.sqrt(function(t){var e=t.length;if(e<1)return NaN;if(1===e)return 0;for(var i=function(t){var e=t.length;if(0===e)return NaN;for(var i=0,r=-1;++r<e;)i+=(t[r]-i)/(r+1);return i}(t),r=-1,n=0;++r<e;){var o=t[r]-i;n+=o*o}return n/(e-1)}(t)),i)*Math.pow(t.length,-.2)}function m(t){return t.reduce(function(t,e){return[Math.min(t[0],e),Math.max(t[1],e)]},[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY])}function f(t,e){var i=t.q3-t.q1,r=Math.max(t.min,t.q1-i),n=Math.min(t.max,t.q3+i);if(Array.isArray(e)){for(var o=0;o<e.length;o++){var a=e[o];if(r<=a){r=a;break}}for(var l=e.length-1;0<=l;l--){var s=e[l];if(s<=n){n=s;break}}}return{whiskerMin:r,whiskerMax:n}}function d(t){if(0===t.length)return{outliers:[]};(t=t.filter(function(t){return"number"==typeof t&&!isNaN(t)})).sort(function(t,e){return t-e});var e=m(t);return{min:e[0],max:e[1],median:c(t,[.5])[0],kde:function(){var o=n,a=[],i=l;function r(t,e){var n=i.call(this,a);return t.map(function(t){for(var e=-1,i=0,r=a.length;++e<r;)i+=o((t-a[e])/n);return[t,i/n/r]})}return r.kernel=function(t){return arguments.length?(o=t,r):o},r.sample=function(t){return arguments.length?(a=t,r):a},r.bandwidth=function(t){return arguments.length?(i="function"==typeof(e=t)?e:function(){return e},r):i;var e},r}().sample(t)}}function v(t){if(!t)return null;if("number"!=typeof t.median||"number"!=typeof t.q1||"number"!=typeof t.q3)return Array.isArray(t)?(void 0===t.__stats&&(t.__stats=function(t){if(0===t.length)return{min:NaN,max:NaN,median:NaN,q1:NaN,q3:NaN,whiskerMin:NaN,whiskerMax:NaN,outliers:[]};(t=t.filter(function(t){return"number"==typeof t&&!isNaN(t)})).sort(function(t,e){return t-e});var e=h(c(t,[.5,.25,.75]),3),i=e[0],r=e[1],n=e[2],o=m(t),a={min:o[0],max:o[1],median:i,q1:r,q3:n,outliers:[]},l=f(a,t),s=l.whiskerMin,u=l.whiskerMax;return a.outliers=t.filter(function(t){return t<s||u<t}),a.whiskerMin=s,a.whiskerMax=u,a}(t)),t.__stats):void 0;if(void 0===t.whiskerMin){var e=f(t,Array.isArray(t.items)?t.items.slice().sort(function(t,e){return t-e}):null),i=e.whiskerMin,r=e.whiskerMax;t.whiskerMin=i,t.whiskerMax=r}return t}function i(t){if(!t)return t;if("number"==typeof t||"string"==typeof t)return Number(t);var e=v(t);return e?e.median:t}var r={ticks:{minStats:"min",maxStats:"max"}};function o(a){var l=this,r=this.chart,n=this.isHorizontal(),t=this.options.ticks,s=t.minStats,u=t.maxStats;this.min=null,this.max=null,r.data.datasets.forEach(function(t,e){var i,o=r.getDatasetMeta(e);r.isDatasetVisible(e)&&(i=o,n?i.xAxisID===l.id:i.yAxisID===l.id)&&t.data.forEach(function(t,e){if(t&&!o.data[e].hidden){var i,r,n=(r=u,"number"==typeof(i=t)[s]&&"number"==typeof i[r]?i:Array.isArray(i)&&0!==i.length?v(i):void 0);n&&((null===l.min||n[s]<l.min)&&(l.min=n[s]),(null===l.max||n[u]>l.max)&&(l.max=n[u]),a&&a(n))}})})}var a=Object.assign({},u.defaults.global.elements.rectangle,{borderWidth:1,outlierRadius:2,outlierColor:u.defaults.global.elements.rectangle.backgroundColor,itemRadius:0,itemStyle:"circle",itemBackgroundColor:u.defaults.global.elements.rectangle.backgroundColor,itemBorderColor:u.defaults.global.elements.rectangle.borderColor,hitPadding:2}),s=u.Element.extend({isVertical:function(){return void 0!==this._view.width},draw:function(){},_drawItems:function(e,t,i,r){if(!(e.itemRadius<=0||!t.items||t.items.length<=0)){i.save(),i.strokeStle=e.itemBorderColor,i.fillStyle=e.itemBackgroundColor;var n,o=(void 0===(n=1e3*this._datasetIndex+this._index)&&(n=Date.now()),function(){return(n=(9301*n+49297)%233280)/233280});r?t.items.forEach(function(t){u.canvasHelpers.drawPoint(i,e.itemStyle,e.itemRadius,e.x-e.width/2+o()*e.width,t)}):t.items.forEach(function(t){u.canvasHelpers.drawPoint(i,e.itemStyle,e.itemRadius,t,e.y-e.height/2+o()*e.height)}),i.restore()}},_drawOutliers:function(e,t,i,r){t.outliers&&(i.fillStyle=e.outlierColor,i.beginPath(),r?t.outliers.forEach(function(t){i.arc(e.x,t,e.outlierRadius,0,2*Math.PI)}):t.outliers.forEach(function(t){i.arc(t,e.y,e.outlierRadius,0,2*Math.PI)}),i.fill(),i.closePath())},_getBounds:function(){return{left:0,top:0,right:0,bottom:0}},_getHitBounds:function(){var t=this._view.hitPadding,e=this._getBounds();return{left:e.left-t,top:e.top-t,right:e.right+t,bottom:e.bottom+t}},height:function(){return 0},inRange:function(t,e){if(!this._view)return!1;var i=this._getHitBounds();return t>=i.left&&t<=i.right&&e>=i.top&&e<=i.bottom},inLabelRange:function(t,e){if(!this._view)return!1;var i=this._getHitBounds();return this.isVertical()?t>=i.left&&t<=i.right:e>=i.top&&e<=i.bottom},inXRange:function(t){var e=this._getHitBounds();return t>=e.left&&t<=e.right},inYRange:function(t){var e=this._getHitBounds();return t>=e.top&&t<=e.bottom},getCenterPoint:function(){var t=this._view;return{x:t.x,y:t.y}},getArea:function(){return 0},tooltipPosition_:function(){return this.getCenterPoint()}});u.defaults.global.elements.boxandwhiskers=Object.assign({},a);var x=u.elements.BoxAndWhiskers=s.extend({transition:function(t){var e=u.Element.prototype.transition.call(this,t),i=this._model,r=this._start,n=this._view;return i&&1!==t&&(null==r.boxplot||(i.boxplot===n.boxplot&&(n.boxplot=u.helpers.clone(n.boxplot)),function(t,e,i,r){for(var n=Object.keys(i),o=0;o<n.length;o++){var a=n[o],l=i[a],s=t[a];if(s!==l)if("number"!=typeof l){if(Array.isArray(l))for(var u=e[a],h=Math.min(l.length,s.length),c=0;c<h;++c)u[c]=s[c]+(l[c]-s[c])*r}else e[a]=s+(l-s)*r}}(r.boxplot,n.boxplot,i.boxplot,t))),e},draw:function(){var t=this._chart.ctx,e=this._view,i=e.boxplot,r=this.isVertical();this._drawItems(e,i,t,r),t.save(),t.fillStyle=e.backgroundColor,t.strokeStyle=e.borderColor,t.lineWidth=e.borderWidth,this._drawBoxPlot(e,i,t,r),this._drawOutliers(e,i,t,r),t.restore()},_drawBoxPlot:function(t,e,i,r){if(r){var n=t.x,o=t.width,a=n-o/2;e.q3>e.q1?(i.fillRect(a,e.q1,o,e.q3-e.q1),i.strokeRect(a,e.q1,o,e.q3-e.q1)):(i.fillRect(a,e.q3,o,e.q1-e.q3),i.strokeRect(a,e.q3,o,e.q1-e.q3)),i.beginPath(),i.moveTo(a,e.whiskerMin),i.lineTo(a+o,e.whiskerMin),i.moveTo(n,e.whiskerMin),i.lineTo(n,e.q1),i.moveTo(a,e.whiskerMax),i.lineTo(a+o,e.whiskerMax),i.moveTo(n,e.whiskerMax),i.lineTo(n,e.q3),i.moveTo(a,e.median),i.lineTo(a+o,e.median),i.closePath(),i.stroke()}else{var l=t.y,s=t.height,u=l-s/2;e.q3>e.q1?(i.fillRect(e.q1,u,e.q3-e.q1,s),i.strokeRect(e.q1,u,e.q3-e.q1,s)):(i.fillRect(e.q3,u,e.q1-e.q3,s),i.strokeRect(e.q3,u,e.q1-e.q3,s)),i.beginPath(),i.moveTo(e.whiskerMin,u),i.lineTo(e.whiskerMin,u+s),i.moveTo(e.whiskerMin,l),i.lineTo(e.q1,l),i.moveTo(e.whiskerMax,u),i.lineTo(e.whiskerMax,u+s),i.moveTo(e.whiskerMax,l),i.lineTo(e.q3,l),i.moveTo(e.median,u),i.lineTo(e.median,u+s),i.closePath(),i.stroke()}},_getBounds:function(){var t=this._view,e=this.isVertical(),i=t.boxplot;if(!i)return{left:0,top:0,right:0,bottom:0};if(e){var r=t.x,n=t.width,o=r-n/2;return{left:o,top:i.whiskerMax,right:o+n,bottom:i.whiskerMin}}var a=t.y,l=t.height,s=a-l/2;return{left:i.whiskerMin,top:s,right:i.whiskerMax,bottom:s+l}},height:function(){var t=this._view;return t.base-Math.min(t.boxplot.q1,t.boxplot.q3)},getArea:function(){var t=this._view,e=Math.abs(t.boxplot.q3-t.boxplot.q1);return this.isVertical()?e*t.width:e*t.height}});u.defaults.global.elements.violin=Object.assign({points:100},a);var g=u.elements.Violin=s.extend({transition:function(t){var e=u.Element.prototype.transition.call(this,t),i=this._model,r=this._start,n=this._view;return i&&1!==t&&(null==r.violin||(i.violin===n.violin&&(n.violin=u.helpers.clone(n.violin)),function(t,e,i,r){for(var n=Object.keys(i),o=0;o<n.length;o++){var a=n[o],l=i[a],s=t[a];if(s!==l)if("number"!=typeof l){if("coords"===a)for(var u=e[a],h=Math.min(l.length,s.length),c=0;c<h;++c)u[c].v=s[c].v+(l[c].v-s[c].v)*r,u[c].estimate=s[c].estimate+(l[c].estimate-s[c].estimate)*r}else e[a]=s+(l-s)*r}}(r.violin,n.violin,i.violin,t))),e},draw:function(){var r=this._chart.ctx,t=this._view,e=t.violin,i=this.isVertical();this._drawItems(t,e,r,i),r.save(),r.fillStyle=t.backgroundColor,r.strokeStyle=t.borderColor,r.lineWidth=t.borderWidth;var n=e.coords;if(u.canvasHelpers.drawPoint(r,"rectRot",5,t.x,t.y),r.stroke(),r.beginPath(),i){var o=t.x,a=t.width/2/e.maxEstimate;r.moveTo(o,e.min),n.forEach(function(t){var e=t.v,i=t.estimate;r.lineTo(o-i*a,e)}),r.lineTo(o,e.max),r.moveTo(o,e.min),n.forEach(function(t){var e=t.v,i=t.estimate;r.lineTo(o+i*a,e)}),r.lineTo(o,e.max)}else{var l=t.y,s=t.height/2/e.maxEstimate;r.moveTo(e.min,l),n.forEach(function(t){var e=t.v,i=t.estimate;r.lineTo(e,l-i*s)}),r.lineTo(e.max,l),r.moveTo(e.min,l),n.forEach(function(t){var e=t.v,i=t.estimate;r.lineTo(e,l+i*s)}),r.lineTo(e.max,l)}r.stroke(),r.fill(),r.closePath(),this._drawOutliers(t,e,r,i),r.restore()},_getBounds:function(){var t=this._view,e=this.isVertical(),i=t.violin;if(e){var r=t.x,n=t.width,o=r-n/2;return{left:o,top:i.max,right:o+n,bottom:i.min}}var a=t.y,l=t.height,s=a-l/2;return{left:i.min,top:s,right:i.max,bottom:s+l}},height:function(){var t=this._view;return t.base-Math.min(t.violin.min,t.violin.max)},getArea:function(){var t=this._view,e=Math.abs(t.violin.max-t.violin.min);return this.isVertical()?e*t.width:e*t.height}}),p={scales:{yAxes:[{type:"arrayLinear"}]}},b={scales:{xAxes:[{type:"arrayLinear"}]}},y={_elementOptions:function(){return{}},updateElement:function(e,i,t){var r=this.getDataset(),n=e.custom||{},o=this._elementOptions();u.controllers.bar.prototype.updateElement.call(this,e,i,t),["outlierRadius","itemRadius","itemStyle","itemBackgroundColor","itemBorderColor","outlierColor","hitPadding"].forEach(function(t){e._model[t]=void 0!==n[t]?n[t]:u.helpers.valueAtIndexOrDefault(r[t],i,o[t])})},_calculateCommonModel:function(t,e,i,r){i.outliers&&(t.outliers=i.outliers.map(function(t){return r.getPixelForValue(Number(t))})),Array.isArray(e)&&(t.items=e.map(function(t){return r.getPixelForValue(Number(t))}))}},w={tooltips:{callbacks:{label:function(t,e){var i=e.datasets[t.datasetIndex].label||"",r=v(e.datasets[t.datasetIndex].data[t.index]),n="".concat(i," ").concat("string"==typeof t.xLabel?t.xLabel:t.yLabel);return r?"".concat(n," (min: ").concat(r.min,", q1: ").concat(r.q1,", median: ").concat(r.median,", q3: ").concat(r.q3,", max: ").concat(r.max,")"):n+"NaN"}}}};u.defaults.boxplot=u.helpers.merge({},[u.defaults.bar,p,w]),u.defaults.horizontalBoxplot=u.helpers.merge({},[u.defaults.horizontalBar,b,w]);var _=Object.assign({},y,{dataElementType:u.elements.BoxAndWhiskers,_elementOptions:function(){return this.chart.options.elements.boxandwhiskers},updateElementGeometry:function(t,e,i){u.controllers.bar.prototype.updateElementGeometry.call(this,t,e,i),t._model.boxplot=this._calculateBoxPlotValuesPixels(this.index,e)},_calculateBoxPlotValuesPixels:function(t,e){var i=this.getValueScale(),r=this.chart.data.datasets[t].data[e];if(!r)return null;var n=v(r),o={};return Object.keys(n).forEach(function(t){"outliers"!==t&&(o[t]=i.getPixelForValue(Number(n[t])))}),this._calculateCommonModel(o,r,n,i),o}}),k=u.controllers.boxplot=u.controllers.bar.extend(_),M=u.controllers.horizontalBoxplot=u.controllers.horizontalBar.extend(_),q={};u.defaults.violin=u.helpers.merge({},[u.defaults.bar,p,q]),u.defaults.horizontalViolin=u.helpers.merge({},[u.defaults.horizontalBar,b,q]);var T=Object.assign({},y,{dataElementType:u.elements.Violin,_elementOptions:function(){return this.chart.options.elements.violin},updateElementGeometry:function(t,e,i){u.controllers.bar.prototype.updateElementGeometry.call(this,t,e,i);var r=t.custom||{},n=this._elementOptions();t._model.violin=this._calculateViolinValuesPixels(this.index,e,void 0!==r.points?r.points:n.points)},_calculateViolinValuesPixels:function(t,e,i){for(var r,n=this.getValueScale(),o=this.chart.data.datasets[t].data[e],a=(r=o)?"number"!=typeof r.median||"function"!=typeof r.kde&&!Array.isArray(r.coords)?Array.isArray(r)?(void 0===r.__kde&&(r.__kde=d(r)),r.__kde):void 0:r:null,l=[],s=(a.max-a.min)/i,u=a.min;u<=a.max;u+=s)l.push(u);l[l.length-1]!==a.max&&l.push(a.max);var h=a.coords||a.kde(l).map(function(t){return{v:t[0],estimate:t[1]}}),c={min:n.getPixelForValue(a.min),max:n.getPixelForValue(a.max),median:n.getPixelForValue(a.median),coords:h.map(function(t){var e=t.v,i=t.estimate;return{v:n.getPixelForValue(e),estimate:i}}),maxEstimate:h.reduce(function(t,e){return Math.max(t,e.estimate)},Number.NEGATIVE_INFINITY)};return this._calculateCommonModel(c,o,a,n),c}}),N=(u.controllers.violin=u.controllers.bar.extend(T),u.controllers.horizontalViolin=u.controllers.horizontalBar.extend(T)),P=u.helpers.merge({},[r,u.scaleService.getScaleDefaults("linear")]),V=u.scaleService.getScaleConstructor("linear").extend({getRightValue:function(t){return u.LinearScaleBase.prototype.getRightValue.call(this,i(t))},determineDataLimits:function(){o.call(this),this.handleTickRangeOptions()}});u.scaleService.registerScaleType("arrayLinear",V,P);var S=u.helpers,A=S.merge({},[r,u.scaleService.getScaleDefaults("logarithmic")]),B=u.scaleService.getScaleConstructor("logarithmic").extend({getRightValue:function(t){return u.LinearScaleBase.prototype.getRightValue.call(this,i(t))},determineDataLimits:function(){var i=this,r=this.options.ticks;this.minNotZero=null,o.call(this,function(t){var e=t[r.minStats];0!==e&&(null===i.minNotZero||e<i.minNotZero)&&(i.minNotZero=e)}),this.min=S.valueOrDefault(r.min,this.min-.05*this.min),this.max=S.valueOrDefault(r.max,this.max+.05*this.max),this.min===this.max&&(0!==this.min&&null!==this.min?(this.min=Math.pow(10,Math.floor(S.log10(this.min))-1),this.max=Math.pow(10,Math.floor(S.log10(this.max))+1)):(this.min=1,this.max=10))}});u.scaleService.registerScaleType("arrayLogarithmic",B,A),t.BoxAndWhiskers=x,t.Violin=g,t.ArrayLinearScale=V,t.ArrayLogarithmicScale=B,t.BoxPlot=k,t.HorizontalBoxPlot=M,t.HorizontalViolin=N,Object.defineProperty(t,"__esModule",{value:!0})});
